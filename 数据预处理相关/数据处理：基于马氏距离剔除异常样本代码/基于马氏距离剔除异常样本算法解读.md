# 基于马氏距离剔除异常样本算法解读

## 1. 核心公式和原理

### 马氏距离公式
```
D²(x, μ) = (x - μ)ᵀ Σ⁻¹ (x - μ)
```

**公式参数说明：**
- `x`：待检测的样本向量
- `μ`：数据集的均值向量
- `Σ`：数据集的协方差矩阵
- `Σ⁻¹`：协方差矩阵的逆矩阵
- `D²(x, μ)`：马氏距离的平方

### 算法原理
1. **聪明的距离计算**：不像普通距离只看远近，马氏距离还会考虑数据的"形状"和特征之间的关系
2. **自动平衡不同单位**：身高用厘米、体重用公斤，算法会自动处理这种单位差异，无需手动调整
3. **智能设定异常标准**：你只需告诉算法"我想找出最异常的2%"，它就会自动确定什么样的数据算异常

## 2. 适用数据类型

- **数字类型的数据**：比如身高、体重、温度、销售额等可以测量的数据
- **特征有关联的数据**：比如身高和体重通常相关，收入和消费相关的这类数据
- **混合单位的数据**：数据中有厘米、公斤、元等不同单位混在一起也没关系
- **正常分布的数据**：大部分数据集中在中间，少数在两端的常见数据分布

## 3. 输入输出格式

### 输入格式
```python
mahalanobis_outlier_detection(data, outlier_fraction=0.02)
```

- **data**：numpy数组，形状 `(m, n)`
  - m：样本数量
  - n：特征维度
  - 每行一个样本，每列一个特征
- **outlier_fraction**：异常样本比例（默认2%）

### 输出格式
返回四元组：
- **inliers**：正常样本索引列表
- **outliers**：异常样本索引列表  
- **distances**：所有样本的马氏距离数组
- **threshold**：判定阈值

### 使用示例
```python
# 执行异常检测
inliers, outliers, distances, threshold = mahalanobis_outlier_detection(data, 0.02)

# 结果解释
print(f"正常样本数：{len(inliers)}")
print(f"异常样本数：{len(outliers)}")
print(f"判定阈值：{threshold:.4f}")
```

## 4. 算法特点

**优势：**
- 考虑特征相关性，比欧氏距离更准确
- 自动处理不同量纲的特征
- 基于统计学原理，有理论基础

**限制：**
- 假设数据近似正态分布
- 需要协方差矩阵可逆（样本数 > 特征数）
- 对极端异常值敏感
